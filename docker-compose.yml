version: '3'

services:
  # Layanan Backend Flask
  backend:
    build:
      context: ./backend  # Path ke direktori backend Anda
    container_name: flask-backend
    ports:
      - "5000:5000"  # Port backend
    environment:
      - MQTT_BROKER=${MQTT_BROKER}  # Menggunakan variabel dari .env
      - MQTT_PORT=${MQTT_PORT}      # Menggunakan variabel dari .env
      - MQTT_USER=${MQTT_USER}      # Menggunakan variabel dari .env
      - MQTT_PASS=${MQTT_PASS}      # Menggunakan variabel dari .env
      - MYSQL_HOST=${MYSQL_HOST}    # Menggunakan variabel dari .env
      - MYSQL_PORT=${MYSQL_PORT}    # Menggunakan variabel dari .env
      - MYSQL_USER=${MYSQL_USER}    # Menggunakan variabel dari .env
      - MYSQL_PASSWORD=${MYSQL_PASSWORD}  # Menggunakan variabel dari .env
      - MYSQL_DB=${MYSQL_DB}        # Menggunakan variabel dari .env
      - AES_KEY=${AES_KEY}          # Menggunakan variabel dari .env
    networks:
      - app-network

  # Layanan Frontend React
  frontend:
    build:
      context: ./frontend  # Path ke direktori frontend Anda
    container_name: react-frontend
    ports:
      - "3000:3000"  # Port frontend
    depends_on:
      - backend  # Menunggu backend untuk berjalan
    networks:
      - app-network

networks:
  app-network:
    driver: bridge
